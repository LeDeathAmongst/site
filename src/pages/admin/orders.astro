---
import Layout from "../../layouts/Layout.astro";
import OrderCard from "../..//components/OrderCard.astro";
import { createSignal, onMount } from "solid-js";

// Create signals for orders and errors
const [orders, setOrders] = createSignal([]);
const [error, setError] = createSignal("");

// Fetch orders on mount
onMount(async () => {
  try {
    const response = await fetch('/admin/orders?pin=1104');
    if (!response.ok) {
      throw new Error('Failed to fetch orders');
    }
    const data = await response.json();
    setOrders(data);
  } catch (err) {
    setError(err.message);
  }
});
---

<Layout
  title="Orders - Rosie"
  ogTitle="Orders"
  description="Submitted orders from customers."
>
  <ArticleIndex title="Orders" navCurrent="/admin/orders">
    <Fragment slot="description">
      Here are the orders submitted by customers. You can view the details of each order below.
    </Fragment>

    {error() && (
      <p class="error">{error()}</p>
    )}

    {orders().length > 0 ? (
      orders().map(order => (
        <OrderCard order={order} />
      ))
    ) : (
      <p>No orders found.</p>
    )}
  </ArticleIndex>
</Layout>

<style>
  .error {
    color: red;
  }
</style>
